{{- range $.Values.issuers }}
  {{- if .create }}
    {{- if and (eq (include "cert-manager-webhook-ovh.isOvhAuthenticationAvail" .) "true") (eq (include "cert-manager-webhook-ovh.isOvhAuthenticationRefAvail" .) "true") }}
        {{ fail (printf "Invalid issuer %s: You cannot define both 'ovhAuthentication' and 'ovhAuthenticationRef' for '%s' authentication method" .name .ovhAuthenticationMethod) }}
    {{- end }}
    {{/* ----- ðŸ“„ Only create a secret when the credentials are directly defined ----- */}}
    {{- if eq (include "cert-manager-webhook-ovh.isOvhAuthenticationAvail" .) "true" }}
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: {{ printf "%s-ovh-credentials" .name }}
  {{- if eq .kind "Issuer" }}
  namespace: {{ .namespace | quote }}
  {{- else }}
  namespace: {{ $.Release.Namespace | quote }}
  {{- end }}
  labels:
    {{- include "cert-manager-webhook-ovh.labels" $ | nindent 4 }}
data:
  {{- if eq .ovhAuthenticationMethod "application" }}
  applicationKey: {{ .ovhAuthentication.applicationKey | b64enc | quote }}
  applicationSecret: {{ .ovhAuthentication.applicationSecret | b64enc | quote }}
  applicationConsumerKey: {{ .ovhAuthentication.applicationConsumerKey | b64enc | quote }}
  {{- else if eq .ovhAuthenticationMethod "oauth2" }}
  oauth2ClientID: {{ .ovhAuthentication.oauth2ClientID | b64enc | quote }}
  oauth2ClientSecret: {{ .ovhAuthentication.oauth2ClientSecret | b64enc | quote }}
  {{- end }}
---
    {{- end }}{{/* end if eq (include "cert..." */}}
  {{- end }}{{/* end if .create */}}
{{- end }}{{/* end range */}}
