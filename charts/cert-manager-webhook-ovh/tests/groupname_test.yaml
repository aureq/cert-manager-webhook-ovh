---
suite: Testing `root.groupName` option in `apiservice.yaml` 1/1
templates:
  - apiservice.yaml
values:
  - values/valid/values-full.yaml
tests:
  - it: Validate use of `groupName` field in APIService
    documentSelector:
      path: kind
      value: APIService
    asserts:
      - equal:
          path: metadata.name
          value: v1alpha1.acme.helm.unittest.example
      - equal:
          path: spec.group
          value: acme.helm.unittest.example
---
suite: Testing `root.groupName` option in `deployment.yaml` 1/1
templates:
  - deployment.yaml
values:
  - values/valid/values-full.yaml
tests:
  - it: Validate use of `groupName` field in Deployment
    documentSelector:
      path: kind
      value: Deployment
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[0].value
          value: acme.helm.unittest.example
---
suite: Testing `root.groupName` option in `issuer.yaml` 1/1
templates:
  - issuer.yaml
values:
  - values/valid/values-full.yaml
tests:
  - it: Validate use of `groupName` field in ClusterIssuer
    documentSelector:
      path: metadata.name
      value: letsencrypt-prod
    asserts:
      - equal:
          path: spec.acme.solvers[0].dns01.webhook.groupName
          value: acme.helm.unittest.example
---
suite: Testing `root.groupName` option in `rbac.yaml` 1/1
templates:
  - rbac.yaml
values:
  - values/valid/values-full.yaml
tests:
  - it: Validate use of `groupName` field in ClusterRole
    documentSelector:
      path: $[?(@.kind == "ClusterRole")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh:domain-solver
    asserts:
      - equal:
          path: rules[0].apiGroups[0]
          value: acme.helm.unittest.example
