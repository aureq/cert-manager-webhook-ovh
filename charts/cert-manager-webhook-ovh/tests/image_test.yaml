---
suite: Testing `root.image` option in `deployment.yaml` 1/3
templates:
  - deployment.yaml
values:
  - values/valid/values.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate use of `image` option in `Deployment`
    documentSelector:
      path: $[?(@.kind == "Deployment")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh
    asserts:
      - equal:
          path: kind
          value: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME-cert-manager-webhook-ovh
      - equal:
          path: spec.template.spec.containers[0].name
          value: cert-manager-webhook-ovh
      - equal:
          path: spec.template.spec.containers[0].image
          value: ghcr.io/aureq/cert-manager-webhook-ovh:1.0.0
      - equal:
          path: spec.template.spec.containers[0].imagePullPolicy
          value: IfNotPresent
      - notExists:
          path: spec.template.spec.containers[0].imagePullSecrets
---
suite: Testing `root.image` option in `deployment.yaml` 2/3
templates:
  - deployment.yaml
values:
  - values/valid/values.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
set:
  image:
    tag: "sha256:abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789"
tests:
  - it: Validate use of `image` option in `Deployment`
    documentSelector:
      path: $[?(@.kind == "Deployment")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: ghcr.io/aureq/cert-manager-webhook-ovh@sha256:abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789
---
suite: Testing `root.image` option in `deployment.yaml` 3/3
templates:
  - deployment.yaml
values:
  - values/valid/values.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
set:
  image:
    pullSecrets:
      - docker-registry-secret
      - internal-registry-secret
tests:
  - it: Validate use of `image` option in `Deployment`
    documentSelector:
      path: $[?(@.kind == "Deployment")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh
    asserts:
      - equal:
          path: spec.template.spec.imagePullSecrets
          value:
            - name: docker-registry-secret
            - name: internal-registry-secret
