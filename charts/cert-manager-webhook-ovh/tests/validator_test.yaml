suite: Testing `validator.yaml` 1/x
templates:
  - validator.yaml
values:
  - values/invalid/values-2-authentications-dir.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: ""
---
suite: Testing `validator.yaml` 2/x
templates:
  - validator.yaml
values:
  - values/invalid/values-2-authentications-ref.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: ""
---
suite: Testing `validator.yaml` 3/x
templates:
  - validator.yaml
values:
  - values/invalid/values-2-application-authentications.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: ""
---
suite: Testing `validator.yaml` 4/x
templates:
  - validator.yaml
values:
  - values/invalid/values-2-oauth2-authentications.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: ""
---
suite: Testing `validator.yaml` 5/x
templates:
  - validator.yaml
values:
  - values/invalid/values-crossed-authentication-method.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: "Invalid issuer configuration 'letsencrypt-prod': Missing required fields for 'application' authentication method. applicationCredentials=false, applicationRef=false"
---
suite: Testing `validator.yaml` 6/x
templates:
  - validator.yaml
values:
  - values/valid/values-issuer-partial.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate successful rendering in `validator.yaml` 1/x
    asserts:
      - notFailedTemplate: {}

---
suite: Testing `validator.yaml` 7/x
templates:
  - validator.yaml
values:
  - values/valid/values-no-eab.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate successful rendering in `validator.yaml` 1/x
    asserts:
      - notFailedTemplate: {}
      # fixme: should also check eab keys are not present in rendered yaml

---
suite: Testing `validator.yaml` 8/x
templates:
  - validator.yaml
values:
  - values/invalid/values-eab-empty-keyid.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: "Invalid issuer 'eab-1': Missing value for required field 'externalAccountBinding.keyID' for external account binding configuration."

---
suite: Testing `validator.yaml` 9/x
templates:
  - validator.yaml
values:
  - values/invalid/values-eab-empty-key-secret-ref-name.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: "Invalid issuer 'eab-1': Missing value for required field 'externalAccountBinding.keySecretRef.name' for external account binding configuration."

---
suite: Testing `validator.yaml` 10/x
templates:
  - validator.yaml
values:
  - values/invalid/values-eab-empty-key-secret-ref-key.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: "Invalid issuer 'eab-1': Missing value for required field 'externalAccountBinding.keySecretRef.key' for external account binding configuration."

---
suite: Testing `validator.yaml` 11/x
templates:
  - validator.yaml
values:
  - values/invalid/values-empty-groupname.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Validate failed rendering in `validator.yaml` 1/x
    asserts:
      - failedTemplate:
          errorMessage: "Invalid configuration: Missing value for required field 'groupName'."
