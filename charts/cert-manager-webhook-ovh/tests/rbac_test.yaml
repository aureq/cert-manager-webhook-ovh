---
suite: Testing `root.rbac` option in `rbac.yaml` 1/4
templates:
  - rbac.yaml
values:
  - values/valid/values-full.yaml
tests:
  - it: Validate use of `rbac` option in `Role`/`ClusterRole`
    documentSelector:
      path: $[?(@.kind == "Role")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
    asserts:
      - equal:
          path: kind
          value: Role
      - equal:
          path: metadata.name
          value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
      - equal:
          path: rules[0].resourceNames
          value:
            - "le-staging-app-dir-ovh-credentials"
            - "le-staging-oidc-dir-ovh-credentials"
            - "letsencrypt-prod-ovh-credentials"
            - "ovh-credentials"
---
suite: Testing `root.rbac` option in `rbac.yaml` 2/4
templates:
  - rbac.yaml
values:
  - values/valid/values-full.yaml
set:
  rbac:
    roleType: ClusterRole
tests:
  - it: Validate use of `rbac` option in `Role`/`ClusterRole`
    documentSelector:
      path: $[?(@.kind == "ClusterRole")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
    asserts:
      - equal:
          path: kind
          value: ClusterRole
      - equal:
          path: metadata.name
          value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
      - equal:
          path: rules[0].resourceNames
          value:
            - "le-staging-app-dir-ovh-credentials"
            - "le-staging-oidc-dir-ovh-credentials"
            - "letsencrypt-prod-ovh-credentials"
            - "ovh-credentials"
---
suite: Testing `root.rbac` option in `rbac.yaml` 3/4
templates:
  - rbac.yaml
values:
  - values/valid/values-full.yaml
tests:
  - it: Validate use of `rbac` option in `RoleBinding`
    documentSelector:
      path: $[?(@.kind == "RoleBinding")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
    asserts:
      - equal:
          path: kind
          value: RoleBinding
      - equal:
          path: metadata.name
          value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
      - equal:
          path: roleRef.kind
          value: Role
---
suite: Testing `root.rbac` option in `rbac.yaml` 4/4
templates:
  - rbac.yaml
values:
  - values/valid/values-full.yaml
set:
  rbac:
    roleType: ClusterRole
tests:
  - it: Validate use of `rbac` option in `RoleBinding`
    documentSelector:
      path: $[?(@.kind == "RoleBinding")].metadata.name
      value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
    asserts:
      - equal:
          path: kind
          value: RoleBinding
      - equal:
          path: metadata.name
          value: RELEASE-NAME-cert-manager-webhook-ovh:secret-reader
      - equal:
          path: roleRef.kind
          value: ClusterRole