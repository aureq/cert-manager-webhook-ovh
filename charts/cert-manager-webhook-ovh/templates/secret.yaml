{{- range $.Values.issuers }}
  {{- if .create }}
    {{- if not (or .ovhAuthentication .ovhAuthenticationRef) }}
      {{ fail "Error: For each issuer you wish to create, you need to define either 'ovhAuthentication' or 'ovhAuthenticationRef'" }}
    {{- end }}
    {{- if eq (include "cert-manager-webhook-ovh.isOvhAuthenticationAvail" .ovhAuthentication) "true" }}
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: {{ printf "%s-ovh-credentials" .name }}
  {{- if eq .kind "Issuer" }}
  namespace: {{ .namespace | quote }}
  {{- else }}
  namespace: {{ $.Release.Namespace | quote }}
  {{- end }}
  labels:
    {{- include "cert-manager-webhook-ovh.labels" $ | nindent 4 }}
data:
  {{- if eq "application" .ovhAuthentication.authenticationMethod }}
  applicationKey: {{ .ovhAuthentication.applicationKey | b64enc | quote }}
  applicationSecret: {{ .ovhAuthentication.applicationSecret | b64enc | quote }}
  consumerKey: {{ .ovhAuthentication.consumerKey | b64enc | quote }}
  {{- else if eq "oauth2" .ovhAuthentication.authenticationMethod }}
  oauth2ClientId: {{ .ovhAuthentication.oauth2ClientId | b64enc | quote }}
  oauth2ClientSecret: {{ .ovhAuthentication.oauth2ClientSecret | b64enc | quote }}
  {{- end }}
---
    {{- end }}{{/* end if eq (include "cert..." */}}
  {{- end }}{{/* end if .create */}}
{{- end }}{{/* end range */}}